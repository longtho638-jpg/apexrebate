(()=>{var e={};e.id=7824,e.ids=[5069,7824],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,t,r)=>{"use strict";r.d(t,{db:()=>s,prisma:()=>i});var a=r(96330);let s=globalThis.prisma??new a.PrismaClient({log:["query"]}),i=s},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23870:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var a=r(55511);let s={randomUUID:a.randomUUID},i=new Uint8Array(256),n=i.length,o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));let d=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let d=(e=e||{}).random??e.rng?.()??(n>i.length-16&&((0,a.randomFillSync)(i),n=0),i.slice(n,n+=16));if(d.length<16)throw Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=d[e];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(d)}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74930:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>h,runtime:()=>l});var s=r(96559),i=r(48088),n=r(37719),o=r(32190),d=r(44999),u=r(5069),p=r(23870),c=r(85663);let l="nodejs";async function h(e){try{let t=(await (0,d.headers)()).get("authorization"),r=`Bearer ${process.env.SEED_SECRET_KEY}`;if(!process.env.SEED_SECRET_KEY||t!==r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let a=await e.json().catch(()=>({})),s=a.email||process.env.TEST_USER_EMAIL||"ci.e2e.tester@apexrebate.com",i=a.password||process.env.TEST_USER_PASSWORD||"Password123!",n=Math.max(1,Math.min(24,a.payouts??6)),l=Math.max(0,Math.min(24,a.startMonthsAgo??5)),h=(a.brokers&&a.brokers.length>0?a.brokers:["binance","bybit","okx"]).map(e=>e.toLowerCase()),m=a.clean??!0,g=Math.max(0,Math.min(10,a.referralsCount??2)),f=a.grantAchievements??!0,w=await u.db.users.findUnique({where:{email:s}});if(!w){let e=await c.Ay.hash(i,12);w=await u.db.users.create({data:{id:(0,p.A)(),email:s,name:"E2E Tester",password:e,role:"USER",emailVerified:new Date,preferredBroker:"binance",experience:"intermediate",updatedAt:new Date}})}m&&await u.db.$transaction([u.db.payouts.deleteMany({where:{userId:w.id}}),u.db.user_activities.deleteMany({where:{userId:w.id}}),u.db.user_achievements.deleteMany({where:{userId:w.id}})]);let E=new Date,S=[],b=0,v=0;for(let e=0;e<n;e++){let t=l-Math.floor(e*l/Math.max(1,n-1)),r=new Date(E);r.setMonth(E.getMonth()-t),r.setDate(14+3*e%10);let a=new Date(r);a.setDate(a.getDate()+1);let s=h[e%h.length],i=12e5+15e4*e,o=.001*i,d=.4*o,u=.1*d,c=50+5*e,m=Math.round((u+c)*100)/100;b+=i,v+=m,S.push({id:(0,p.A)(),userId:w.id,amount:m,currency:"USD",period:function(e){let t=new Date(e);t.setDate(t.getDate()-6);let r=e=>e.toISOString().slice(0,10);return`${r(t)} to ${r(e)}`}(a),broker:s,tradingVolume:i,feeRate:.001,status:"PROCESSED",processedAt:a,createdAt:r,updatedAt:new Date,notes:"Seeded for E2E"})}let A=[];if(S.forEach(e=>A.push(u.db.payouts.create({data:e}))),A.push(u.db.user_activities.create({data:{id:(0,p.A)(),userId:w.id,type:"TRADING_VOLUME",description:"Seeded trading volume for E2E",metadata:JSON.stringify({totalTradingVolume:b}),points:0}})),A.push(u.db.user_activities.create({data:{id:(0,p.A)(),userId:w.id,type:"PAYOUT_RECEIVED",description:"Seeded payouts for E2E",metadata:JSON.stringify({totalAmount:v}),points:0}})),f){let e=await u.db.achievements.upsert({where:{name:"first_savings"},update:{},create:{id:(0,p.A)(),name:"first_savings",title:"Tiết kiệm đầu ti\xean",description:"Ho\xe0n th\xe0nh lần ho\xe0n ph\xed đầu ti\xean",icon:"Star",category:"SAVINGS",points:50,tier:"BRONZE",condition:"payouts_count>=1",isActive:!0}}),t=await u.db.achievements.upsert({where:{name:"referral_1"},update:{},create:{id:(0,p.A)(),name:"referral_1",title:"Người giới thiệu",description:"Giới thiệu th\xe0nh c\xf4ng 1 th\xe0nh vi\xean",icon:"Users",category:"REFERRALS",points:100,tier:"SILVER",condition:"referrals>=1",isActive:!0}});A.push(u.db.user_achievements.create({data:{id:(0,p.A)(),userId:w.id,achievementId:e.id,progress:100,pointsAwarded:50}})),A.push(u.db.user_achievements.create({data:{id:(0,p.A)(),userId:w.id,achievementId:t.id,progress:100,pointsAwarded:100}}))}for(let e=0;e<g;e++){let t=await u.db.users.create({data:{id:(0,p.A)(),email:`ref${e}.${Date.now()}@example.com`,name:`Referral ${e+1}`,password:null,role:"USER",referredBy:w.id,emailVerified:new Date,updatedAt:new Date}}),r=20+5*e;A.push(u.db.payouts.create({data:{id:(0,p.A)(),userId:t.id,amount:r,currency:"USD",period:"referral bonus",broker:h[e%h.length],tradingVolume:1e5+1e4*e,feeRate:.001,status:"PROCESSED",processedAt:new Date,updatedAt:new Date,notes:"Referral seeded payout"}}))}return A.push(u.db.users.update({where:{id:w.id},data:{totalSaved:(w.totalSaved||0)+v,tradingVolume:(w.tradingVolume||0)+b,referralCount:g,updatedAt:new Date}})),await u.db.$transaction(A),o.NextResponse.json({success:!0,userId:w.id,email:w.email,created:n,totalAmount:Math.round(100*v)/100,totalTradingVolume:b,referralsCount:g})}catch(e){return console.error("[SEED TEST DATA] Error:",e),o.NextResponse.json({error:"Internal server error",message:e?.message},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/testing/seed-test-data/route",pathname:"/api/testing/seed-test-data",filename:"route",bundlePath:"app/api/testing/seed-test-data/route"},resolvedPagePath:"/Users/macbookprom1/apexrebate-1/src/app/api/testing/seed-test-data/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:g,workUnitAsyncStorage:f,serverHooks:w}=m;function E(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:f})}},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7719,4999,580,8044],()=>r(74930));module.exports=a})();