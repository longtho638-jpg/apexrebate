(()=>{var e={};e.id=5584,e.ids=[5069,5584],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,r,t)=>{"use strict";t.d(r,{db:()=>i,prisma:()=>n});var a=t(96330);let i=globalThis.prisma??new a.PrismaClient({log:["query"]}),n=i},8719:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{isRequestAPICallableInsideAfter:function(){return c},throwForSearchParamsAccessInUseCache:function(){return o},throwWithStaticGenerationBailoutError:function(){return n},throwWithStaticGenerationBailoutErrorWithDynamicError:function(){return s}});let a=t(80023),i=t(3295);function n(e,r){throw Object.defineProperty(new a.StaticGenBailoutError(`Route ${e} couldn't be rendered statically because it used ${r}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E576",enumerable:!1,configurable:!0})}function s(e,r){throw Object.defineProperty(new a.StaticGenBailoutError(`Route ${e} with \`dynamic = "error"\` couldn't be rendered statically because it used ${r}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E543",enumerable:!1,configurable:!0})}function o(e){let r=Object.defineProperty(Error(`Route ${e.route} used "searchParams" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "searchParams" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E634",enumerable:!1,configurable:!0});throw e.invalidUsageError??=r,r}function c(){let e=i.afterTaskAsyncStorage.getStore();return(null==e?void 0:e.rootTaskSpawnPhase)==="action"}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43763:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ReflectAdapter",{enumerable:!0,get:function(){return t}});class t{static get(e,r,t){let a=Reflect.get(e,r,t);return"function"==typeof a?a.bind(e):a}static set(e,r,t,a){return Reflect.set(e,r,t,a)}static has(e,r){return Reflect.has(e,r)}static deleteProperty(e,r){return Reflect.deleteProperty(e,r)}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47228:(e,r,t)=>{"use strict";t.d(r,{D:()=>s});var a=t(5069),i=t(96330),n=t(59232);class s{static async createOrUpdateUser(e){try{let r=await a.db.users.findUnique({where:{email:e.email}}),t=null;if(e.referralCode&&!r){let r=await a.db.users.findUnique({where:{referralCode:e.referralCode}});r&&(t=r.id)}if(r)return await a.db.users.update({where:{email:e.email},data:{tradingVolume:e.tradingVolume?parseFloat(e.tradingVolume):void 0,preferredBroker:e.preferredBroker,experience:e.experience,referralSource:e.referralSource,lastActiveAt:new Date,updatedAt:new Date}});{let r=(0,n.Ak)(8).toUpperCase();return await a.db.users.create({data:{email:e.email,name:e.name,tradingVolume:e.tradingVolume?parseFloat(e.tradingVolume):0,preferredBroker:e.preferredBroker,experience:e.experience,referralSource:e.referralSource,referralCode:r,referredBy:t,tier:i.UserTier.BRONZE,totalSaved:0,referralCount:0,points:0,streak:1,badgeCount:0,updatedAt:new Date}})}}catch(e){throw console.error("Error creating/updating user:",e),e}}static async getUserByEmail(e){try{return await a.db.users.findUnique({where:{email:e},include:{payouts:{orderBy:{createdAt:"desc"},take:10},achievements:{include:{achievement:!0}},activities:{orderBy:{createdAt:"desc"},take:20}}})}catch(e){throw console.error("Error fetching user:",e),e}}static async updateUserSavings(e,r){try{let t=await a.db.users.findUnique({where:{id:e}});if(!t)throw Error("User not found");let n=t.totalSaved+r,s=this.calculateUserTier(n),o=await a.db.users.update({where:{id:e},data:{totalSaved:n,tier:s,lastActiveAt:new Date}});return await this.recordActivity(e,i.ActivityType.SAVINGS_MILESTONE,`Saved $${r.toFixed(2)} in rebates`,{amount:r,newTotal:n}),s!==t.tier&&await this.recordActivity(e,i.ActivityType.TIER_UPGRADE,`Upgraded to ${s} tier`,{oldTier:t.tier,newTier:s}),o}catch(e){throw console.error("Error updating user savings:",e),e}}static calculateUserTier(e){return e>=1e4?i.UserTier.DIAMOND:e>=5e3?i.UserTier.PLATINUM:e>=2e3?i.UserTier.GOLD:e>=500?i.UserTier.SILVER:i.UserTier.BRONZE}static async recordActivity(e,r,t,i){try{return await a.db.userActivity.create({data:{userId:e,type:r,description:t,metadata:i?JSON.stringify(i):null,points:this.getActivityPoints(r)}})}catch(e){throw console.error("Error recording activity:",e),e}}static getActivityPoints(e){switch(e){case i.ActivityType.LOGIN:return 1;case i.ActivityType.REFERRAL:return 50;case i.ActivityType.SAVINGS_MILESTONE:return 10;case i.ActivityType.TIER_UPGRADE:return 100;case i.ActivityType.ACHIEVEMENT_UNLOCKED:return 25;case i.ActivityType.TRADING_VOLUME:return 5;case i.ActivityType.PAYOUT_RECEIVED:return 15;case i.ActivityType.STREAK_MILESTONE:return 20;default:return 0}}static async getWallOfFame(e=50){try{return(await a.db.users.findMany({where:{totalSaved:{gt:0}},orderBy:{totalSaved:"desc"},take:e,select:{id:!0,name:!0,totalSaved:!0,tier:!0,createdAt:!0,payouts:{select:{broker:!0,amount:!0,createdAt:!0},orderBy:{createdAt:"desc"},take:1}}})).map((e,r)=>({id:e.id,anonymousName:`Trader ${String.fromCharCode(65+r)}`,totalSavings:e.totalSaved,broker:e.payouts[0]?.broker||"Unknown",memberSince:e.createdAt.toISOString().split("T")[0],tier:e.tier,rank:r+1}))}catch(e){throw console.error("Error fetching Wall of Fame:",e),e}}static async getDashboardAnalytics(e){try{let r=await a.db.users.findUnique({where:{id:e},include:{payouts:{orderBy:{createdAt:"desc"},take:100},activities:{orderBy:{createdAt:"desc"},take:50},achievements:{include:{achievement:!0}}}});if(!r)throw Error("User not found");let t=r.payouts,i=t.reduce((e,r)=>e+r.tradingVolume,0),n=this.calculateMonthlySavings(t),s=this.calculateBrokerStats(t),o=this.calculateSavingsHistory(t);return{userData:{totalSavings:r.totalSaved,monthlySavings:n,totalVolume:i,memberSince:r.createdAt.toISOString().split("T")[0],rank:r.tier,nextRankProgress:this.calculateNextRankProgress(r.totalSaved,r.tier),referrals:r.referralCount,referralEarnings:47.5*r.referralCount},savingsHistory:o,brokerStats:s,achievements:r.achievements.map(e=>({id:e.achievement.id,title:e.achievement.title,description:e.achievement.description,icon:e.achievement.icon,unlocked:100===e.progress,date:e.unlockedAt.toISOString().split("T")[0],progress:e.progress}))}}catch(e){throw console.error("Error fetching dashboard analytics:",e),e}}static calculateMonthlySavings(e){let r=new Date().getMonth(),t=new Date().getFullYear();return e.filter(e=>{let a=new Date(e.createdAt);return a.getMonth()===r&&a.getFullYear()===t}).reduce((e,r)=>e+r.amount,0)}static calculateBrokerStats(e){let r=new Map;e.forEach(e=>{let t=r.get(e.broker)||{volume:0,savings:0};r.set(e.broker,{volume:t.volume+e.tradingVolume,savings:t.savings+e.amount})});let t=Array.from(r.values()).reduce((e,r)=>e+r.volume,0);return Array.from(r.entries()).map(([e,r])=>({broker:e,volume:r.volume,savings:r.savings,percentage:t>0?r.volume/t*100:0}))}static calculateSavingsHistory(e){let r=new Map;return e.forEach(e=>{let t=e.createdAt.toISOString().substring(0,7),a=r.get(t)||{savings:0,volume:0};r.set(t,{savings:a.savings+e.amount,volume:a.volume+e.tradingVolume})}),Array.from(r.entries()).sort((e,r)=>e[0].localeCompare(r[0])).slice(-12).map(([e,r])=>({month:e,savings:r.savings,volume:r.volume}))}static calculateNextRankProgress(e,r){let t={[i.UserTier.BRONZE]:500,[i.UserTier.SILVER]:2e3,[i.UserTier.GOLD]:5e3,[i.UserTier.PLATINUM]:1e4,[i.UserTier.DIAMOND]:1e4},a=t[r],n=t[this.getNextTier(r)];return r===i.UserTier.DIAMOND?100:Math.min(100,Math.max(0,(e-a)/(n-a)*100))}static getNextTier(e){switch(e){case i.UserTier.BRONZE:return i.UserTier.SILVER;case i.UserTier.SILVER:return i.UserTier.GOLD;case i.UserTier.GOLD:return i.UserTier.PLATINUM;case i.UserTier.PLATINUM:default:return i.UserTier.DIAMOND}}}},55511:e=>{"use strict";e.exports=require("crypto")},59232:(e,r,t)=>{"use strict";let a,i;t.d(r,{Ak:()=>o});var n=t(55511);let s=e=>{!a||a.length<e?(a=Buffer.allocUnsafe(128*e),n.randomFillSync(a),i=0):i+e>a.length&&(n.randomFillSync(a),i=0),i+=e},o=(e=21)=>{s(e|=0);let r="";for(let t=i-e;t<i;t++)r+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&a[t]];return r}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97759:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>p});var a={};t.r(a),t.d(a,{GET:()=>u});var i=t(96559),n=t(48088),s=t(37719),o=t(32190),c=t(47228);let l=[{id:"1",anonymousName:"Trader Alpha",totalSavings:2847,broker:"Binance",memberSince:"2024-01-15",referralCode:"ALPHA"},{id:"2",anonymousName:"Trader Beta",totalSavings:1923,broker:"Bybit",memberSince:"2024-01-20",referralCode:"BETA"},{id:"3",anonymousName:"Trader Gamma",totalSavings:1567,broker:"OKX",memberSince:"2024-02-01",referralCode:"GAMMA"},{id:"4",anonymousName:"Trader Delta",totalSavings:1234,broker:"Binance",memberSince:"2024-02-10",referralCode:"DELTA"},{id:"5",anonymousName:"Trader Epsilon",totalSavings:987,broker:"Bybit",memberSince:"2024-02-15",referralCode:"EPSILON"}];async function u(){try{let e=[],r=0;try{r=(e=await c.D.getWallOfFame(10)).reduce((e,r)=>e+r.totalSavings,0),0===e.length&&(e=l,r=l.reduce((e,r)=>e+r.totalSavings,0))}catch(t){console.error("Database error, using mock data:",t),e=l,r=l.reduce((e,r)=>e+r.totalSavings,0)}return o.NextResponse.json({success:!0,data:e,totalSaved:r,stats:{totalMembers:e.length,averageSavings:e.length>0?r/e.length:0,topSaver:e.length>0?e[0]:null}})}catch(e){return console.error("Wall of Fame API error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/wall-of-fame/route",pathname:"/api/wall-of-fame",filename:"route",bundlePath:"app/api/wall-of-fame/route"},resolvedPagePath:"/Users/macbookprom1/apexrebate-1/src/app/api/wall-of-fame/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:m,workUnitAsyncStorage:p,serverHooks:g}=d;function v(){return(0,s.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:p})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[7719,580],()=>t(97759));module.exports=a})();