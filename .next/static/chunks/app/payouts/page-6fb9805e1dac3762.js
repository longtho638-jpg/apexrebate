(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6326],{30347:(e,s,t)=>{"use strict";t.d(s,{A:()=>o});var l=t(95155),a=t(12108),n=t(35695),c=t(12115),r=t(66695),i=t(30285),d=t(75525),x=t(70306),h=t(6874),m=t.n(h);function o(e){let{children:s,fallback:t}=e,{data:h,status:o}=(0,a.useSession)(),u=(0,n.useRouter)();return((0,c.useEffect)(()=>{"loading"!==o&&(h||u.push("/auth/signin"))},[h,o,u]),"loading"===o)?(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-slate-600",children:"Đang kiểm tra x\xe1c thực..."})]})}):h?(0,l.jsx)(l.Fragment,{children:s}):t||(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white flex items-center justify-center px-4",children:(0,l.jsx)("div",{className:"max-w-md w-full",children:(0,l.jsxs)(r.Zp,{children:[(0,l.jsxs)(r.aR,{className:"text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)(d.A,{className:"w-8 h-8 text-blue-600"})}),(0,l.jsx)(r.ZB,{className:"text-2xl",children:"Y\xeau cầu x\xe1c thực"})]}),(0,l.jsxs)(r.Wu,{className:"space-y-4 text-center",children:[(0,l.jsx)("p",{className:"text-slate-600",children:"Bạn cần đăng nhập để truy cập trang n\xe0y."}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(m(),{href:"/auth/signin",children:(0,l.jsxs)(i.$,{className:"w-full bg-blue-600 hover:bg-blue-700",children:[(0,l.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Đăng nhập"]})}),(0,l.jsx)(m(),{href:"/auth/signup",children:(0,l.jsx)(i.$,{variant:"outline",className:"w-full",children:"Tạo t\xe0i khoản mới"})})]})]})]})})})}},65800:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var l=t(95155),a=t(12115),n=t(12108),c=t(35695),r=t(66695),i=t(30285),d=t(26126),x=t(59409),h=t(40646),m=t(14186),o=t(85339),u=t(53904),j=t(91788),b=t(33109),p=t(69074),N=t(66932),g=t(55868),f=t(92657),v=t(30347),w=t(79787),y=t(56671);function A(){let{data:e,status:s}=(0,n.useSession)(),t=(0,c.useRouter)(),[A,S]=(0,a.useState)(null),[k,E]=(0,a.useState)(!0),[C,D]=(0,a.useState)({broker:"all",status:"all",period:"all"}),[R,T]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"unauthenticated"===s?t.push("/auth/signin"):"authenticated"===s&&L()},[s,t]);let L=async()=>{try{let e=await fetch("/api/user/payouts"),s=await e.json();s.success&&S(s.data)}catch(e){console.error("Failed to fetch payout data:",e),y.oR.error("Kh\xf4ng thể tải dữ liệu thanh to\xe1n")}finally{E(!1)}},F=async()=>{T(!0),await L(),T(!1),y.oR.success("Dữ liệu đ\xe3 được cập nhật")},P=(null==A?void 0:A.payouts.filter(e=>("all"===C.broker||e.broker===C.broker)&&("all"===C.status||e.status===C.status)&&("all"===C.period||!!e.period.includes(C.period))))||[],$=e=>{switch(e){case"PROCESSED":return"bg-green-100 text-green-800 border-green-200";case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"FAILED":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},V=e=>{switch(e){case"PROCESSED":return(0,l.jsx)(h.A,{className:"w-4 h-4"});case"PENDING":default:return(0,l.jsx)(m.A,{className:"w-4 h-4"});case"FAILED":return(0,l.jsx)(o.A,{className:"w-4 h-4"})}},Z=e=>{switch(e){case"PROCESSED":return"Đ\xe3 xử l\xfd";case"PENDING":return"Đang xử l\xfd";case"FAILED":return"Thất bại";default:return e}};return"loading"===s||k?(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-slate-600",children:"Loading..."})]})}):A?(0,l.jsx)(v.A,{children:(0,l.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,l.jsx)(w.A,{}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Lịch sử Thanh to\xe1n"}),(0,l.jsx)("p",{className:"text-slate-600",children:"Theo d\xf5i tất cả c\xe1c khoản thanh to\xe1n ho\xe0n ph\xed của bạn"})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsxs)(i.$,{variant:"outline",onClick:F,disabled:R,children:[(0,l.jsx)(u.A,{className:"w-4 h-4 mr-2 ".concat(R?"animate-spin":"")}),"L\xe0m mới"]}),(0,l.jsxs)(i.$,{variant:"outline",onClick:()=>{if(!A)return;let e=new Blob([["Ng\xe0y,Kỳ,S\xe0n,Số tiền,Trạng th\xe1i,Khối lượng,Tỷ lệ ph\xed",...A.payouts.map(e=>[new Date(e.createdAt).toLocaleDateString("vi-VN"),e.period,e.broker,e.amount.toFixed(2),e.status,e.tradingVolume.toLocaleString(),(100*e.feeRate).toFixed(3)+"%"].join(","))].join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="payouts-".concat(new Date().toISOString().split("T")[0],".csv"),t.click(),window.URL.revokeObjectURL(s),y.oR.success("Đ\xe3 xuất file CSV")},children:[(0,l.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"Xuất CSV"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,l.jsx)(r.Zp,{children:(0,l.jsxs)(r.Wu,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Tổng đ\xe3 nhận"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["$",A.summary.processedAmount.toFixed(2)]})]}),(0,l.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(h.A,{className:"w-6 h-6 text-green-600"})})]}),(0,l.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:[A.summary.totalPayouts," giao dịch"]})]})}),(0,l.jsx)(r.Zp,{children:(0,l.jsxs)(r.Wu,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Đang xử l\xfd"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-yellow-600",children:["$",A.summary.pendingAmount.toFixed(2)]})]}),(0,l.jsx)("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(m.A,{className:"w-6 h-6 text-yellow-600"})})]}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"Chờ x\xe1c nhận"})]})}),(0,l.jsx)(r.Zp,{children:(0,l.jsxs)(r.Wu,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Trung b\xecnh"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["$",A.summary.averagePayout.toFixed(2)]})]}),(0,l.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(b.A,{className:"w-6 h-6 text-blue-600"})})]}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"Mỗi lần thanh to\xe1n"})]})}),(0,l.jsx)(r.Zp,{children:(0,l.jsxs)(r.Wu,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Th\xe1ng n\xe0y"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-purple-600",children:["$",A.summary.currentMonthAmount.toFixed(2)]})]}),(0,l.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(p.A,{className:"w-6 h-6 text-purple-600"})})]}),(0,l.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:[A.summary.currentMonthPayouts," lần"]})]})})]}),(0,l.jsx)(r.Zp,{className:"mb-6",children:(0,l.jsxs)(r.Wu,{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center mb-4",children:[(0,l.jsx)(N.A,{className:"w-5 h-5 mr-2"}),(0,l.jsx)("h3",{className:"font-semibold",children:"Bộ lọc"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-slate-700 mb-2 block",children:"S\xe0n giao dịch"}),(0,l.jsxs)(x.l6,{value:C.broker,onValueChange:e=>D(s=>({...s,broker:e})),children:[(0,l.jsx)(x.bq,{children:(0,l.jsx)(x.yv,{})}),(0,l.jsxs)(x.gC,{children:[(0,l.jsx)(x.eb,{value:"all",children:"Tất cả"}),A.filters.brokers.map(e=>(0,l.jsx)(x.eb,{value:e,children:e},e))]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-slate-700 mb-2 block",children:"Trạng th\xe1i"}),(0,l.jsxs)(x.l6,{value:C.status,onValueChange:e=>D(s=>({...s,status:e})),children:[(0,l.jsx)(x.bq,{children:(0,l.jsx)(x.yv,{})}),(0,l.jsxs)(x.gC,{children:[(0,l.jsx)(x.eb,{value:"all",children:"Tất cả"}),A.filters.statuses.map(e=>(0,l.jsx)(x.eb,{value:e,children:Z(e)},e))]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-slate-700 mb-2 block",children:"Kỳ"}),(0,l.jsxs)(x.l6,{value:C.period,onValueChange:e=>D(s=>({...s,period:e})),children:[(0,l.jsx)(x.bq,{children:(0,l.jsx)(x.yv,{})}),(0,l.jsxs)(x.gC,{children:[(0,l.jsx)(x.eb,{value:"all",children:"Tất cả"}),A.filters.periods.map(e=>(0,l.jsx)(x.eb,{value:e,children:e},e))]})]})]})]})]})}),(0,l.jsxs)(r.Zp,{children:[(0,l.jsx)(r.aR,{children:(0,l.jsxs)(r.ZB,{className:"flex justify-between items-center",children:[(0,l.jsxs)("span",{children:["Lịch sử thanh to\xe1n (",P.length,")"]}),P.length!==A.payouts.length&&(0,l.jsxs)(d.E,{variant:"outline",children:["Đ\xe3 lọc: ",P.length,"/",A.payouts.length]})]})}),(0,l.jsx)(r.Wu,{children:0===P.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)(g.A,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-slate-600 mb-2",children:"Kh\xf4ng c\xf3 giao dịch n\xe0o"}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"all"!==C.broker||"all"!==C.status||"all"!==C.period?"Thử thay đổi bộ lọc":"Bắt đầu giao dịch để nhận ho\xe0n ph\xed"})]}):(0,l.jsx)("div",{className:"space-y-4",children:P.map(e=>(0,l.jsxs)("div",{className:"border border-slate-200 rounded-lg p-6 hover:bg-slate-50 transition-colors",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat("PROCESSED"===e.status?"bg-green-100":"PENDING"===e.status?"bg-yellow-100":"bg-red-100"),children:V(e.status)}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-1",children:[(0,l.jsxs)("h4",{className:"font-semibold text-slate-900",children:["$",e.amount.toFixed(2)]}),(0,l.jsx)(d.E,{className:$(e.status),children:Z(e.status)}),(0,l.jsx)(d.E,{variant:"outline",children:e.broker})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-slate-600",children:[(0,l.jsxs)("span",{children:["Kỳ: ",e.period]}),(0,l.jsx)("span",{children:"•"}),(0,l.jsxs)("span",{children:["Khối lượng: $",e.tradingVolume.toLocaleString()]}),(0,l.jsx)("span",{children:"•"}),(0,l.jsxs)("span",{children:["Tỷ lệ: ",(100*e.feeRate).toFixed(3),"%"]})]}),(0,l.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Ng\xe0y tạo: ",new Date(e.createdAt).toLocaleString("vi-VN"),e.processedAt&&(0,l.jsxs)("span",{children:[" • Đ\xe3 xử l\xfd: ",new Date(e.processedAt).toLocaleString("vi-VN")]})]})]})]}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsx)(i.$,{variant:"ghost",size:"sm",children:(0,l.jsx)(f.A,{className:"w-4 h-4"})})})]}),e.notes&&(0,l.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 rounded text-sm text-blue-800",children:[(0,l.jsx)("strong",{children:"Ghi ch\xfa:"})," ",e.notes]})]},e.id))})})]})]})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,l.jsx)(r.Zp,{className:"max-w-md w-full",children:(0,l.jsxs)(r.Wu,{className:"p-6 text-center",children:[(0,l.jsx)("p",{className:"text-red-600 mb-4",children:"Kh\xf4ng thể tải dữ liệu thanh to\xe1n"}),(0,l.jsx)(i.$,{onClick:L,children:"Thử lại"})]})})})}},82953:(e,s,t)=>{Promise.resolve().then(t.bind(t,65800))}},e=>{var s=s=>e(e.s=s);e.O(0,[3455,3942,2108,6874,1057,8583,6671,4007,9787,8441,1684,7358],()=>s(82953)),_N_E=e.O()}]);