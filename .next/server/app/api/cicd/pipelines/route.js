(()=>{var e={};e.id=6379,e.ids=[5069,6379],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,t,s)=>{"use strict";s.d(t,{db:()=>n,prisma:()=>a});var r=s(96330);let n=globalThis.prisma??new r.PrismaClient({log:["query"]}),a=n},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,t,s)=>{"use strict";s.d(t,{N:()=>o});var r=s(60890),n=s(13581),a=s(36344),i=s(5069),u=s(85663);let o={adapter:(0,r.y)(i.db),providers:[...process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET?[(0,a.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})]:[],(0,n.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i.db.users.findUnique({where:{email:e.email}});return t&&t.password&&await u.Ay.compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,role:t.role}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"}}},13581:(e,t)=>{"use strict";t.A=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},36344:(e,t)=>{"use strict";t.A=function(e){return{id:"google",name:"Google",type:"oauth",wellKnown:"https://accounts.google.com/.well-known/openid-configuration",authorization:{params:{scope:"openid email profile"}},idToken:!0,checks:["pkce","state"],profile:e=>({id:e.sub,name:e.name,email:e.email,image:e.picture}),style:{logo:"/google.svg",bg:"#fff",text:"#000"},options:e}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},60890:(e,t)=>{"use strict";t.y=void 0,t.y=function(e){return{createUser:t=>e.user.create({data:t}),getUser:t=>e.user.findUnique({where:{id:t}}),getUserByEmail:t=>e.user.findUnique({where:{email:t}}),async getUserByAccount(t){var s;let r=await e.account.findUnique({where:{provider_providerAccountId:t},select:{user:!0}});return null!=(s=null==r?void 0:r.user)?s:null},updateUser:({id:t,...s})=>e.user.update({where:{id:t},data:s}),deleteUser:t=>e.user.delete({where:{id:t}}),linkAccount:t=>e.account.create({data:t}),unlinkAccount:t=>e.account.delete({where:{provider_providerAccountId:t}}),async getSessionAndUser(t){let s=await e.session.findUnique({where:{sessionToken:t},include:{user:!0}});if(!s)return null;let{user:r,...n}=s;return{user:r,session:n}},createSession:t=>e.session.create({data:t}),updateSession:t=>e.session.update({where:{sessionToken:t.sessionToken},data:t}),deleteSession:t=>e.session.delete({where:{sessionToken:t}}),async createVerificationToken(t){let s=await e.verificationToken.create({data:t});return s.id&&delete s.id,s},async useVerificationToken(t){try{let s=await e.verificationToken.delete({where:{identifier_token:t}});return s.id&&delete s.id,s}catch(e){if("P2025"===e.code)return null;throw e}}}}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97090:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>f,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>w});var r={};s.r(r),s.d(r,{GET:()=>d,POST:()=>p});var n=s(96559),a=s(48088),i=s(37719),u=s(32190),o=s(19854),c=s(12909);let l=()=>[{id:"1",name:"主应用部署管道",description:"主应用程序的完整CI/CD流程",status:"active",lastRun:new Date(Date.now()-18e5).toISOString(),nextRun:new Date(Date.now()+18e5).toISOString(),triggers:["push","pull_request","schedule"],stages:[{name:"代码检查",status:"success",duration:120},{name:"单元测试",status:"success",duration:180},{name:"构建镜像",status:"success",duration:300},{name:"部署到Staging",status:"success",duration:240},{name:"集成测试",status:"running"},{name:"部署到Production",status:"pending"}]},{id:"2",name:"微服务部署管道",description:"微服务架构的独立部署流程",status:"active",lastRun:new Date(Date.now()-72e5).toISOString(),triggers:["push","manual"],stages:[{name:"服务构建",status:"success",duration:200},{name:"容器化",status:"success",duration:150},{name:"服务测试",status:"success",duration:180},{name:"服务部署",status:"success",duration:120}]},{id:"3",name:"数据库迁移管道",description:"数据库schema迁移和备份流程",status:"paused",lastRun:new Date(Date.now()-216e5).toISOString(),triggers:["manual"],stages:[{name:"数据库备份",status:"success",duration:300},{name:"迁移脚本",status:"pending"},{name:"数据验证",status:"pending"},{name:"性能测试",status:"pending"}]},{id:"4",name:"安全扫描管道",description:"安全漏洞扫描和合规检查",status:"active",lastRun:new Date(Date.now()-144e5).toISOString(),triggers:["push","schedule"],stages:[{name:"依赖扫描",status:"success",duration:90},{name:"代码安全分析",status:"success",duration:120},{name:"容器安全扫描",status:"success",duration:150},{name:"合规检查",status:"success",duration:60}]},{id:"5",name:"性能测试管道",description:"负载测试和性能基准测试",status:"inactive",lastRun:new Date(Date.now()-2592e5).toISOString(),triggers:["manual","schedule"],stages:[{name:"负载测试",status:"pending"},{name:"压力测试",status:"pending"},{name:"性能基准",status:"pending"},{name:"报告生成",status:"pending"}]}];async function d(e){try{let t=await (0,o.getServerSession)(c.N);if(!t)return u.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.user?.role||"user";if(!["admin","moderator","developer"].includes(s))return u.NextResponse.json({error:"Insufficient permissions"},{status:403});let{searchParams:r}=new URL(e.url),n=r.get("status"),a=parseInt(r.get("limit")||"20"),i=l();n&&(i=i.filter(e=>e.status===n));let d={total:(i=i.slice(0,a)).length,byStatus:{active:i.filter(e=>"active"===e.status).length,inactive:i.filter(e=>"inactive"===e.status).length,paused:i.filter(e=>"paused"===e.status).length},totalStages:i.reduce((e,t)=>e+t.stages.length,0),runningStages:i.reduce((e,t)=>e+t.stages.filter(e=>"running"===e.status).length,0)},p={success:!0,data:i,stats:d,filters:{status:n,limit:a},timestamp:new Date().toISOString()};return u.NextResponse.json(p)}catch(e){return console.error("Error fetching pipelines:",e),u.NextResponse.json({success:!1,error:"Failed to fetch pipelines",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(e){try{let t=await (0,o.getServerSession)(c.N);if(!t)return u.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.user?.role||"user";if(!["admin","moderator"].includes(s))return u.NextResponse.json({error:"Insufficient permissions"},{status:403});let{name:r,description:n,triggers:a,stages:i}=await e.json();if(!r||!n)return u.NextResponse.json({error:"Missing required fields: name, description"},{status:400});let l={id:Date.now().toString(),name:r,description:n,status:"inactive",lastRun:new Date().toISOString(),triggers:a||["manual"],stages:i||[]};return u.NextResponse.json({success:!0,data:l,message:"Pipeline created successfully",timestamp:new Date().toISOString()})}catch(e){return console.error("Error creating pipeline:",e),u.NextResponse.json({success:!1,error:"Failed to create pipeline",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/cicd/pipelines/route",pathname:"/api/cicd/pipelines",filename:"route",bundlePath:"app/api/cicd/pipelines/route"},resolvedPagePath:"/Users/macbookprom1/apexrebate-1/src/app/api/cicd/pipelines/route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:w,serverHooks:f}=g;function h(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:w})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[7719,580,4999,8044,9854],()=>s(97090));module.exports=r})();