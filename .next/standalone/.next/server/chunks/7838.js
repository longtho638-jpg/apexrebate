"use strict";exports.id=7838,exports.ids=[7838],exports.modules={87838:(t,e,a)=>{a.r(e),a.d(e,{default:()=>c});var o=a(79748),r=a(33873),i=a(21820);let n=async()=>{let t=i.homedir();for(let e of[r.join(process.cwd(),".z-ai-config"),r.join(t,".z-ai-config"),"/etc/.z-ai-config"])try{let t=await o.readFile(e,"utf-8"),a=JSON.parse(t);if(a.baseUrl&&a.apiKey)return a}catch(t){"ENOENT"!==t.code&&console.error(`Error reading or parsing config file at ${e}:`,t)}throw Error("Configuration file not found or invalid. Please create .z-ai-config in your project, home directory, or /etc.")};class s{constructor(t){this.config=t,this.chat={completions:{create:this.createChatCompletion.bind(this)}},this.images={generations:{create:this.createImageGeneration.bind(this)}},this.functions={invoke:this.invokeFunction.bind(this)}}static async create(){return new s(await n())}async createChatCompletion(t){let{baseUrl:e,chatId:a,userId:o,apiKey:r}=this.config,i=`${e}/chat/completions`,n={"Content-Type":"application/json",Authorization:`Bearer ${r}`,"X-Z-AI-From":"Z"};a&&(n["X-Chat-Id"]=a),o&&(n["X-User-Id"]=o);try{let e=await fetch(i,{method:"POST",headers:n,body:JSON.stringify(t)});if(!e.ok){let t=await e.text();throw Error(`API request failed with status ${e.status}: ${t}`)}return await e.json()}catch(t){throw console.error("Failed to make API request:",t),t}}async createImageGeneration(t){let{baseUrl:e,apiKey:a,chatId:o,userId:r}=this.config,i=`${e}/images/generations`,n={"Content-Type":"application/json",Authorization:`Bearer ${a}`,"X-Z-AI-From":"Z"};o&&(n["X-Chat-Id"]=o),r&&(n["X-User-Id"]=r);let s={...t};try{let t=await fetch(i,{method:"POST",headers:n,body:JSON.stringify(s)});if(!t.ok){let e=await t.text();throw Error(`API request failed with status ${t.status}: ${e}`)}let e=await t.json(),a=await Promise.all(e.data.map(async t=>t.url?{base64:await this.downloadImageAsBase64(t.url),format:"png"}:t));return{...e,data:a}}catch(t){throw console.error("Failed to make image generation request:",t),t}}async downloadImageAsBase64(t){try{let e=await fetch(t);if(!e.ok)throw Error(`Failed to download image: ${e.status}`);let a=await e.arrayBuffer(),o=Buffer.from(a).toString("base64");return`${o}`}catch(t){throw console.error("Failed to download and convert image to base64:",t),t}}async invokeFunction(t,e){let{baseUrl:a,apiKey:o,chatId:r,userId:i}=this.config,n=`${a}/functions/invoke`,s={"Content-Type":"application/json",Authorization:`Bearer ${o}`,"X-Z-AI-From":"Z"};r&&(s["X-Chat-Id"]=r),i&&(s["X-User-Id"]=i);try{let a=await fetch(n,{method:"POST",headers:s,body:JSON.stringify({function_name:t,arguments:e})});if(!a.ok){let t=await a.text();throw Error(`Function invoke failed with status ${a.status}: ${t}`)}return(await a.json()).result}catch(t){throw console.error("Failed to invoke remote function:",t),t}}}let c=s}};